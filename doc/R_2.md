## 2. Описание библиотеки

### Введение

В состав языка программирования РефалАБ входит набор функций и спецификаторов,
которые могут быть использованы в РЕФАЛ-программах в качестве внешних.
Эти функции и спецификаторы хранятся в библиотеке объектных модулей,
входящей в состав РЕФАЛ-системы. 

Чтобы использовать любую из этих функций или спецификаторов в программе,
написанной на РЕФАЛе, необходимо объявить ее внешней в соответствующем модуле
с помощью директивы EXTRN.

Часть библиотечных функций и спецификаторы написаны на РЕФАЛе и скомпилированы
в объектные модули с помощью РЕФАЛ-компилятора и GNU Assembler.
Остальные функции реализованы на языке Си и являются первичными.

### 2.1. Функции ввода-вывода

Функции ввода-вывода предназначены для организации простейшего
диалогового взаимодействия между пользователем и программой.
Такими функциями являются:
- [card](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-card) (для ввода строк с клавиатуры);
- [print](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-print) (для вывода информации на экран дисплея);
- [prout](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-prout) (для вывода информации на экран дисплея);
- [printm](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-printm) (для вывода информации на экран дисплея);
- [proutm](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-proutm) (для вывода информации на экран дисплея).

Функции print, prout, printm и proutm различаются возвращаемым в
поле зрения значением и способом представления информации на экране.

Ввод и вывод может быть переназначен в произвольный файл средствами
операционной системы.

### 2.2. Функции арифметики

Функции арифметики работают с целыми числами. Целое число - это
последовательность макроцифр (т.е. "цифр" в позиционной системе
счисления по основанию 2^24), которой может предшествовать символ знака.
Примерами целых чисел являются:

    '+' /14/
    /545/
    '-' /8/
    /1//0/ - значение этого числа равно 2^24=16777216
    '-'/3//2035/ - значение этого числа равно -50333683
    /0/

Целое число нуль представляется либо нулевой макроцифрой /0/, либо
пустым выражением.

Все функции арифметики, кроме p1 и m1, допускают использование пустого выражения в
качестве аргумента и воспринимают его как нуль.

К функциям арифметики относятся:
- [add](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-add) (сложение);
- addn (альтернативное сложение);
- [mul](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-mul) (умножение);
- muln (альтернативное умножение);
- [sub](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-sub) (вычитание);
- subn (альтернативное вычитание);
- [dr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-dr) (деление нацело с остатком);
- drn (альтернативное деление нацело с остатком);
- [div](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-div) (деление нацело);
- divn (альтернативное деление нацело);
- gcd (вычисление наибольшего общего делителя);
- [p1](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-p1) (прибавление единицы);
- [m1](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-m1) (вычитание единицы);
- [nrel](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-nrel) (сравнение целых чисел).

Для преобразования целых чисел в символьный вид и обратно используются
следующие функции:
- [symb](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-symb) (целое, не превышающее по абсолютной величине 2147483647 - в символьный вид);
- [Cvd](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-cvd) (целое любой длины - в символьный вид);
- [numb](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-numb) (последовательность символов - в целое, не превышающее по абсолютной величине 2147483647);
- [Cvb](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-cvb) (последовательность символов - в целое любой длины).

### 2.3. Функции и спецификаторы лексического анализа

Стандартная библиотека РЕФАЛа содержит ряд функций, полезных при
выполнении лексического анализа в трансляторах, системах естественноязыкового
общения, языковых конверторах и т.д. Такими функциями являются:
- lrel (предназначена для лексикографического сравнения двух выражений);
- [first](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-first) (предназначена для отщепления от начала выражения части,
имеющей указанную длину);
- [last](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-last) (предназначена для отщепления от конца выражения части,
имеющей указанную длину);
- [lengw](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B8-lengw) (вычисляет длину аргумента, измеренную в термах, т.е. количество
термов нулевого уровня, составляющих аргумент);
- [lengr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-lengr) (вычисляет реальную длину аргумента, т.е. количество символов
и скобок, составляющих аргумент);
- [multe](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-multe) (копирует (размножает) аргумент в заданном количестве экземпляров);
- Exist (определяет существование терма в выражении на нулевом уровне);
- Set (формирует множество термов нулевого уровня аргумента);
- IsWSpace (определяет принадлежность символа к пробелам);
- Trim (удаляет пробелы в начале и в конце аргумента);
- TrimL (удаляет пробелы в начале аргумента);
- TrimR (удаляет пробелы в конце аргумента).

Также в библиотеке есть спецификатор WSpaces - множество пробелов.

### 2.4. Функции для работы с символьными файлами

Описываемые в этом разделе функции позволяют работать не более чем
с десятью файлами одновременно. При этом пять файлов доступны только на
чтение (они именуются "файлами чтения") и пять файлов - только на запись
(они именуются "файлами записи").

Работа с файлами производится с помощью следующих первичных функций:
- [opnget](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-opnget) (открыть файл чтения);
- [opnput](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-opnput) (открыть файл записи);
- [libget](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-libget) (читать файл);
- [libput](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-libput) (записать в файл);
- [clsget](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-clsget) (закрыть файл чтения);
- [clsput](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-clsput) (закрыть файл записи);
- [renam](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-renam) (переименовать/переместить файл);
- [unlnk](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-unlnk) (удалить файл).

Функции opnget и opnput связывают с заданным именем файла определенный номер
(число от 0 до 4). Для выполнения какой-либо операции с
файлом с помощью функций libget, libput, clsget и clsput следует указывать
его номер, помещая соответствующую макроцифру в аргументе (нулевой
номер можно не указывыть - он используется по умолчанию).

Кроме того, в библиотеке есть еще функции для совместимости
с языком программирования Рефал-5. Эти функции позволяют работать с другим файлами
и тоже не более чем с десятью файлами одновременно. При этом пять файлов доступны только на
чтение (они именуются "файлами чтения") и пять файлов - только на запись
(они именуются "файлами записи").

К этим функциям относятся следующие функции:
- xopen (открыть файл);
- LoadFile (загрузить файл);
- SaveFile (сохранить файл);
- AppFile (добавить в файл);
- xget (читать файл);
- xput (записать в файл);
- xclose (закрыть файл).

Функции xopen, LoadFile, SaveFile, AppFile связывают с заданным именем файла обязательный определенный номер
(число от 0 до 4). Для выполнения какой-либо операции с
файлом с помощью функций xget, xput, xclose следует обязательно указывать
его номер, помещая соответствующую макроцифру в аргументе.

### 2.5. Функция порождения процесса

Функция [apply](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-apply) позволяет писать программы, анализирующие аварийные
ситуации типа "отождествление невозможно" или "свободная память исчерпана"
и предпринимающие некоторые дальнейшие действия по обработке таких ситуаций.

Функция apply порождает новое поле зрения, помещает в него функциональный терм,
определенный в ее аргументе, и пытается вычислить его.
Результат такой попытки возвращается в то поле зрения, из которого была
вызвана apply.

После того, как результат замены сформирован, дополнительное поле
зрения, созданное в результате обращения к apply, уничтожается.

Можно обращаться к apply рекурсивно. В этом случае образуется стек
из полей зрения, однако глубина рекурсии ограничена. Увеличив размер
системного стека, можно увеличить глубину вложенности apply.

### 2.6. Функции для работы с символами-метками

В некоторых случаях возникает необходимость превратить цепочку объектных символов
в символ-метку или, наоборот, получить из символа-метки цепочку объектных
символов, составляющих его тело. Например, из цепочки символов 'ABCDE'
построить символ /ABCDE/ или символ-метку /label/ превратить в цепочку
'label'. При этом должно выполняться следующее требование: если мы будем
превращать одну и ту же цепочку символов в символ-метку несколько раз,
то все созданные символы-метки должны быть равны друг другу,
т.е. являться экземплярами одного и того же символа.

Для создания символов-меток и обратного превращения их в цепочки
объектных символов используются функции ftochar, chartof и functab:
- [ftochar](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-ftochar) (превращает символ-метку в цепочку символов, которая
является телом символа-метки);
- [chartof](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-chartof) (превращает цепочку символов в символ-метку, имеющий тело,
совпадающее с заданной цепочкой символов, при этом одна и та же
цепочка символов превращается в один и тот же символ-метку, т.е.
не создается новый экземпляр символа-метки - это достигается за
счет того, что функция создает и поддерживает таблицу символов-меток,
порожденных ею из цепочек символов);
- [functab](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_2.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-functab) (регистрирует в таблице символов, создаваемой функцией
chartof, указанный символ-метку - это требуется делать, если необходимо,
чтобы символ-метка, создаваемый из цепочки символов, заведомо совпадал
с символом-меткой, определенным в РЕФАЛ-программе.

### 2.7. Функции для работы с копилкой

Библиотека РЕФАЛа содержит пять первичных функций для работы с копилкой:
- [br](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%B2r-%D0%B7%D0%B0%D0%BA%D0%BE%D0%BF%D0%B0%D1%82%D1%8C) (закопать);
- [dg](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-dg-%D0%B2%D1%8B%D0%BA%D0%BE%D0%BF%D0%B0%D1%82%D1%8C) (выкопать);
- [cp](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D1%81%D1%80-%D1%81%D0%BA%D0%BE%D0%BF%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D1%82%D1%8C) (скопировать);
- [rp](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-r%D1%80-%D0%B7%D0%B0%D0%BC%D0%B5%D0%BD%D0%B8%D1%82%D1%8C) (заменить);
- [dgall](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-dg%D0%B0ll-%D0%B2%D1%8B%D0%BA%D0%BE%D0%BF%D0%B0%D1%82%D1%8C-%D0%B2%D1%81%D0%B5) (выкопать все).

Подробное описание копилки и операций для работы с ней представлено
в 1 разделе.

### 2.8. Функции для работы со статическими и динамическими ящиками

Средством РЕФАЛа, дающим возможность обрабатывать произвольные графы,
являются статические и динамические ящики.

Библиотека РЕФАЛа содержит шесть первичных функций для работы с ящиками:
- [new](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-new) (создать новый ящик);
- [gtr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-gtr-%D0%B2%D0%B7%D1%8F%D1%82%D1%8C-%D0%BF%D0%BE-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B5) (извлечь из ящика);
- [rdr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-rdr-%D0%BF%D1%80%D0%BE%D1%87%D0%B8%D1%82%D0%B0%D1%82%D1%8C-%D0%BF%D0%BE-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B5) (считать (скопировать) из ящика);
- [wtr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-wtr-%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D0%BF%D0%BE-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B5) (занести в ящик);
- [ptr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-ptr-%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B8%D1%82%D1%8C-%D0%BF%D0%BE-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B5) (добавить в ящик);
- [swr](https://github.com/Aleksandr3Bocharov/RefalAB/blob/main/doc/R_1.md#%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-swr-%D0%BE%D0%B1%D0%BC%D0%B5%D0%BD%D1%8F%D1%82%D1%8C-%D0%BF%D0%BE-%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B5) (обменять с содержимым ящика).

Подробное описание этих функций представлено в 1 разделе.

### 2.9. Функции для работы со временем

Библиотека содержит ряд функций для работы со временем:
- rftime (возвращает текущее время в локали операционной системы);
- rftm (запуск и останов секундомера).

### 2.10. Функция удаления функциональных термов в поле зрения

Функция delf позволяет писать программы, анализирующие поле зрения и
удаляющие из него определенные функциональные термы.

Функция delf изменяет поле зрения, удаляя из него функциональные термы,
находящиеся в определенной цепочке, являющаяся частью последовательности
становления ведущими функциональных термов. Начало цепочки - функциональный терм,
который станет ведущим после ведущего функционального терма, т.е. после вызова функции delf.
Конец цепочки - функциональный терм, за которым следует сразу символ '#'.

### 2.11. Функции высшего порядка

В РЕФАЛе можно создавать функции высшего порядка, т.е. функции, содержащие в аргументе функции
либо в виде символов-меток, либо в виде частично-примененных функций в форме струтктурных термов

    (функция выражение)

где функция - символ-метка или частично-примененная функция.

Примерами функций, передаваемых в функции высшего порядка являются:

    /Add/
    (/Add/ (/2/))
    (/XOpen/ 'r')
    (/XOpen/ 'r' /0/)
    ((/XOpen/ 'r') /0/)

Библиотека РЕФАЛа содержит следующие функции высшего порядка:
- Call (вызывает функцию, переданную в аргументе);
- Map (применяет функцию, переданную в аргументе, ко всем термам нулевого уровня выражения);
- FoldL (левая свертка выражения);
- FoldR (правая свертка выражения);
- MapAccum (гибрид функций Map и FoldL).

Также в библиотеке есть обычная функция DelAccum - вспомогательная
функция для MapAccum (удаляет аккумулятор из возвращаемого выражения).

### 2.12. Функции и спецификаторы, специфичные для сред Windows и POSIX

В библиотеке есть функции и спецификаторы, специфичные для сред Windows и POSIX.
Т.е. возвращаемые выражения этих функций и множества спецификаторов различны для
сред Windows и POSIX. Они применяются для написания программ, по разному ведущих себя
в средах Windows и POSIX.

Такими функциями являются:
- Platform (возвращает текущую среду Windows или POSIX);
- DirSep (возвращает основной символ для разделения уровней папок в строке пути);
- IsDirSep (определяет принадлежность символа к символам для разделения
уровней папок в строке пути);
- PathSep (возвращает символ разделения каталогов в переменной окружения PATH).

Специфичным спецификатором является DirSeps - множество символов для разделения уровней папок в строке пути.

### 2.13. Пустые функции

В библиотеке РЕФАЛа присутствуют следующие пустые функции:
- True (логическая иситина);
- False (логическая ложь);
- Windows (функция Platform возвращает эту функцию в среде Windows,
применяется совместно с Platform и пустой функцией POSIX для написания
программ, по разному ведущих себя в средах Windows и POSIX);
- POSIX (функция Platform возвращает эту функцию в среде POSIX,
применяется совместно с Platform и пустой функцией Windows для написания
программ, по разному ведущих себя в средах Windows и POSIX).

### 2.14. Описание функций

Здесь представлены описания функций, расположенных в алфавитном порядке. Для каждой функции приводится описание; формат вызова (передаваемые аргументы); возвращаемое значение и пример вызова функции в формате

    <вызов функции> --> <результат замены>

#### Функция add

ВЫЗОВ:

    <add (E1) E2>

где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция add предназначена для сложения двух целых чисел E1 и E2.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Результатом вызова функции add является целое число. Если результат
положительный, то знак '+' не ставитcя. Нулевой результат выдается
в виде макроцифры /0/.

ПРИМЕРЫ:

    <add (/1/) /2/> --> /3/
    <add ( ) /2/> --> /2/
    <add (/16777215/) /2/> --> /1//1/

#### Функция apply

ВЫЗОВ:

    <apply E1>

где E1 - произвольное выражение.

ОПИСАНИЕ:

Выполнение этого вызова происходит следующим образом: создается новое
поле зрения, в которое помещается функциональный терм

    < E1>

После этого делается попытка вычислить этот функциональный терм.
Возможны три исхода этой попытки: нормальный останов, останов
"отождествление невозможно" и останов "свободная память исчерпана".
Затем формируется соответствующий результат замены
(возвращаемое значение) и дополнительное поле зрения,
созданное в результате обращения к apply, уничтожается.
Можно обращаться к apply рекурсивно. В этом случае
образуется стек из полей зрения.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

В случае нормального останова результатом замены будет выражение

    'N' E2

где E2 - результат вычисления терма < E1>.

В случае останова "отождествление невозможно" результатом замены
будет выражение

    'R' E3

где E3 - содержимое того функционального терма < E4>,
попытка вычисления которого привела к останову.

В случае останова "свободная память исчерпана" результатом замены будет выражение

    'S'

ПРИМЕР:

Пусть в поле памяти имеется функция:

    rev s1 s2 = s2 s1

Тогда

    <apply /rev/ 'ab'> --> 'N' 'ba'
    <apply /rev/ 'abc'> --> 'R' /rev/'abc'

#### Функция card

ВЫЗОВ:

    <card Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Функция card дает возможность читать записи из стандартного
входного потока. Обычно в качестве входного потока назначается ввод с
клавиатуры, но он может быть переназначен в файл при запуске программы
(в этом случае необходимо следить за соответствием количества вызовов
функции card и количества записей в файле, если записей меньше,
чем вызовов, возможны непредсказуемые результаты).

Вначале работы функция выводит выражение Ee в стандартный выходной поток,
как-будто она вызывает функцию

    <prout Ee>

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

После вызова функции card программа переходит в состояние ожидания
ввода строки. По окончании ввода (нажатии клавиши "Enter") введенная
строка и будет возвращаемым значением. Если в процессе ввода функция
обнаружила в потоке EOF, то функция завершает работу и последний символ
в возвращаемом выражении будет макроцифра /0/.

ПРИМЕР:

    <card > --> 'эта строка введена с клавиатуры'

#### Функция chartof

ВЫЗОВ:

    <chartof Vc>

где Vc - непустая цепочка объектных символов.

ОПИСАНИЕ:

Функция chartof превращает цепочку литер в символ-метку, имеющий
тело, совпадающее с заданной цепочкой литер. Цепочка литер обязанна быть непустой,
количество литер не превышать 255, литеры могут быть любыми. Функция chartof создает и
поддерживает таблицу символов-меток, порожденных ею из цепочек литер.
Если цепочка литер встретилась в первый раз, то создается пустая функция,
имя которой является соответствующим символом-меткой. Если такая же
цепочка литер встречается еще раз, то новая функция не создается, а в
качестве результата вырабатывается имя ранее созданной функции.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: /символ-метка/

ПРИМЕРЫ:

    <chartof '$assA3434^&'> --> /$ASSA3434^&/
    <chartof 'ABCD'> --> /ABCD/

#### Функция clsget

ВЫЗОВ:

    <clsget En>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать).

ОПИСАНИЕ:

Функция clsget предназначена для закрытия соответствующего
файла чтения после того, как работа с ним закончена.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <clsget /3/> -->
    <clsget > -->

#### Функция clsput

ВЫЗОВ:

    <clsput En>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать).

ОПИСАНИЕ:

Функция clsput предназначена для закрытия соответствующего файла
записи после того, как работа с ним закончена.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <clsput /3/> -->
    <clsput > -->

#### Функция Cvb

ВЫЗОВ: 

    <cvb Ed>

где Ed - цепочка символов-литер произвольной длины, являющаяся
десятичной записью целого числа со знаком или без него.
Пустое выражение эквивалентно нулю.

ОПИСАНИЕ:

Преобразует целое число Ed из символьного представления в цепочку
макроцифр со знаком или без него.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

En - число в виде цепочки макроцифр со знаком или без него.
Если результат положителен - знак '+' не ставитcя.
Нулевой результат выдается в виде макроцифры /0/.

ПРИМЕРЫ:

    <cvb > --> /0/
    <cvb '+025'> --> /25/
    <cvb '1000000000'> --> /59//10144256/

#### Функция Cvd

ВЫЗОВ: 


    <cvd En>

где En - целое число в виде цепочки макроцифр (возможно, со знаком) (может быть пустое).

ОПИСАНИЕ:

Преобразует целое число в символьное представление со знаком или без него.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Ed - цепочка символов-литер, являющаяся записью числа En
в десятичной системе счисления. Если число En положительно -
знак '+' в Ed не ставитcя. Нулевой результат изображается как '0'.

ПРИМЕРЫ:

    <cvd '-'/59//10144256/> --> '-1000000000'
    <cvd > --> '0'
    <cvd /0/> --> '0'

#### Функция div

ВЫЗОВ:

    <div ( E1 ) E2>

где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция div предназначена для целочисленного деления числа E1 на
число E2. Попытка делить на ноль приводит к авосту
"Отождествление невозможно".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Целое число, представляющее собой неокругленное частное от деления
E1 на E2. Если результат положителен - знак '+' не ставитcя.
Нулевой результат выдается в виде макроцифры /0/.

ПРИМЕРЫ:

    <div (/5/) /3/> --> /1/
    <div (/5/) '-'/3/> --> '-'/1/
    <div ('-'/5/) /3/> --> '-'/1/
    <div ('-'/5/) '-'/3/> --> /1/

#### Функция dr

ВЫЗОВ:

<dr ( E1 ) E2>

где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция dr предназначена для целочисленного деления
с остатком числа E1 на число E2. Попытка делить на ноль
приводит к авосту "Отождествление невозможно".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Eq (Er)

где Eq (целое число) - частное от деления E1 на E2 , а Er (целое
число) - остаток. И частное, и остаток выдаются без незначащих нулей и
без знака '+'. Нулевые Eq и Er выдаются в виде макроцифры /0/.
Знаки чисел учитываются следующим образом: сначала производим деление,
не обращая внимания на знаки, а затем частному и остатку приписываем
такие знаки, чтобы выполнялось соотношение:

    E1 = Eq * E2 + Er

т.е. частное положительно, если знаки делимого и делителя совпадают, и
отрицательно в противном случае, а не равный нулю остаток всегда имеет
знак делимого.

ПРИМЕРЫ:

    <dr (/5/) /3/> --> /1/ (/2/)
    <dr (/5/) '-'/3/ > --> '-'/1/ (/2/)
    <dr ('-'/5/) /3/> --> '-'/1/ ('-'/2/)
    <dr ('-'/5/) '-'/3/> --> /1/ ('-'/2/)

#### Функция first

ВЫЗОВ:

    <first Nn Ee>

где Nn - макроцифра, а Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Эта функция предназначена для отщепления от начала выражения Ee части,
имеющей указанную длину Nn в термах нулевого уровня.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Если Ee представляет собой последовательность из менее,
чем Nn термов, результатом замены является выражение:

    '*' Ee

Если же длина Ee не меньше, чем Nn термов, результатом замены является

    (E1) E2

где E1 и E2 - такие выражения, что Ee = E1E2, и при этом E1 является
последовательностью ровно из Nn термов.

ПРИМЕРЫ:

    <first /2/ 'A'('B')'C'> --> ('A'('B')) 'C'
    <first /5/ 'A'('B')'C'> --> '*A'('B')'C'

#### Функция ftochar

ВЫЗОВ:

    <ftochar Fx Ee>

где Fx - символ-метка, а Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Эта функция превращает символ-метку в цепочку объектных символов,
которая является телом символа-метки.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Результатом замены является цепочка объектных символов, являющаяся
телом символа Fx.

ПРИМЕРЫ:

    <ftochar /assa3434/> --> 'ASSA3434'
    <ftochar /ABCD/> --> 'ABCD'

#### Функция functab

ВЫЗОВ:

    <functab Fx Ee>

где Fx - символ-метка, а Ee - произвольное объектное выражение.

ОПИСАНИЕ:

В некоторых случаях требуется, чтобы символ-метка, создаваемый из
некоторой цепочки литер заведомо совпадал с символом-меткой,
определенным в РЕФАЛ-программе и имеющим тело, полностью совпадающее
с данной цепочкой литер. Это достигается с помощью функции functab,
которая регистрирует в таблице символов, создаваемой функцией chartof, указанный
символ-метку Fx. После этого, всякий раз, когда функция chartof будет
получать цепочку литер, совпадающую с телом символа Fx, результатом
функции chartof будет символ Fx.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕР:

Пусть в РЕФАЛ-программе определена некоторая функция func1. Тогда
 
    <functab /func1/> -->

и в таблице символов функции chartof окажется зарегистрированным символ-метка /FUNC1/.

#### Функция last

ВЫЗОВ:

    <last Nn Ee>

где Nn - макроцифра, Ee - произвольное выражение.

ОПИСАНИЕ:

Эта функция предназначена для отщепления от конца выражения Ee части,
имеющей указанную длину Nn в термах нулевого уровня.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Если Ee представляет собой последовательность из менее, чем Nn термов,
результатом замены является

    Ee '*'

Если же длина Ee составляет не менее, чем Nn термов, результатом
замены является

    E1 (E2)

где E1 и E2 - такие выражения, что Ee = E1E2 и при этом E2
является последовательностью ровно из Nn термов.

ПРИМЕРЫ:

    <last /2/ 'A'('B')'C'> --> 'A'(('B')'C')
    <last /5/ 'A'('B')'C'> --> 'A'('B')'C*'

#### Функция lengr

ВЫЗОВ:

    <lengr Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Эта функция предназначена для вычисления длины аргумента,
т.е. количества символов и скобок, составляющих Ee.
Длина не должна превосходить 16777215. Если длина превосходит
16777215, дальнейшее поведенеие программы неопределено.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Nn Ee

где Nn - макроцифра, значение которой равно длине выражения Ee.

ПРИМЕР:

    <lengr 'A' () ('A')> --> /6/ 'A' () ('A')

#### Функции lengw

ВЫЗОВ:

    <lengw Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Функция lengw выдает длину выражения, измеренную в термах,
т.е. количество термов нулевого уровня, составляющих Ee.
Длина не должна превосходить 16777215. Если длина превосходит
16777215, дальнейшее поведенеие программы неопределено.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Nn Ee

где Nn - макроцифра, которая равна длине выражения Ee.

ПРИМЕРЫ:

    <lengw 'A' () ('A')> --> /3/ 'A' () ('A')
    <lengw > --> /0/

#### Функция libget

ВЫЗОВ:

    <libget En>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать).

ОПИСАНИЕ:

Функция libget читает очередную запись из предварительно открытого
с помощью функции opnget файла чтения с заданным номером. Попытка чтения
из неоткрытого файла приводит к авосту "отождествление невозможно" и выдаче сообщения "Unknown input file".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Пусто - если файл прочитан до конца, Er - очередная запись из файла
чтения в виде строки объектных символов,
если в файле еще остались непрочитанные записи.

ПРИМЕР:

    <libget /3/> --> 'это очередная прочитанная запись'
    <libget /3/> --> 'это следующая запись из того же файла'

#### Функция libput

ВЫЗОВ:

    <libput En Ee>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать), а Ee - объектное выражение, которое не содержит составных
символов.

ОПИСАНИЕ:

Функция libput записывает в файл с заданным номером (предварительно
открытый с помощью функции opnput) очередную запись Ee. При этом все
структурные скобки в выражении Ee преобразуются в символы-литеры '(' и
')'. Ели аргумент Ee пуст, в файл добавляется пустая запись.
Попытка записи в неоткрытый файл приводит к авосту "отождествление невозможно" и
выдаче сообщения "Unknown output file".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕР:

    <libput 'очередная запись'> -->
    и в конец файла допишется строка 'очередная запись'

#### Функция mul

ВЫЗОВ:

    <mul (E1) E2>
    
где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция mul умножает целые числа E1 и E2.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

En - целое число (произведение). Если результат
положителен - знак '+' не ставитcя. Нулевой результат выдается
в виде макроцифры /0/.

ПРИМЕРЫ:

    <mul (/2/) '-'/2/> --> '-'/4/
    <mul (/2/)> --> /0/
    <mul (/4096/)/4096/> --> /1//0/

#### Функция multe

ВЫЗОВ:

    <multe Nn Ee>

где Nn - макроцифра, а Ee - произвольное объектное выражение.

ОПИСАНИЕ:

Эта функция копирует (размножает) выражение в заданном количестве
экземпляров.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Ee Ee ... Ee

где выражение Ee повторяется Nn раз. В частности, если Nn равно нулю,
результатом замены является пустое выражение.

ПРИМЕРЫ:

    <multe /5/ 'A'> --> 'AAAAA'
    <multe /2/ 'A'('B')> --> 'A'('B')'A'('B')
    <multe /0/> -->

#### Функция m1

ВЫЗОВ:

    <m1 Nn>

где Nn - макроцифра.

ОПИСАНИЕ:

Функция m1 производит вычитание единицы из макроцифры. Попытка вычесть
единицу из макроцифры /0/ приводит к авосту "Отождествление невозможно".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: макроцифра, на единицу меньшая Nn.

ПРИМЕРЫ:

    <m1 /10/> --> /9/
    <m1 /738/> --> /737/
    <m1 /1/> --> /0/

#### Функция nrel

ВЫЗОВ:

    <nrel (E1) E2>

где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция nrel предназначена для сравнения целых чисел с учетом знака.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Sr (E1) E2

где Sr - символ-литера:
- Sr = '>', если E1 > E2;
- Sr = '=', если E1 = E2;
- Sr = '<', если E1 < E2.

ПРИМЕРЫ:

    <nrel (/5/)/3/> --> '>' (/5/)/3/
    <nrel ('-'/5/)'-'/3/> --> '<' ('-'/5/)'-'/3/
    <nrel () /0//0/> --> '=' ()/0//0/

#### Функция numb

ВЫЗОВ:

    <numb Ed>

где Ed - цепочка символов-литер, являющаяся десятичной записью целого числа
со знаком или без него, или пустое выражение (воспринимается как нуль).

ОПИСАНИЕ:

Преобразует целое число, не превышающее по абсолютной величине 2147483647,
из символьного представления в макроцифры со знаком или без него.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

En - число Ed в виде макроцифр со знаком или без него.
Если результат положителен - знак '+' не ставитcя.
Нулевой результат выдается в виде макроцифры /0/.

ПРИМЕРЫ:

    <numb '1000'> --> /1000/
    <numb '-16777216'> --> '-'/1//0/
    <numb > --> /0/
    <numb '1000000000'> --> /59//10144256/
    <numb '+025'> --> /25/

#### Функция opnget

ВЫЗОВ:

    <opnget En Ef>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать), а Ef - объектное выражение, представляющее собой спецификацию
файла.

ОПИСАНИЕ:

Эта функция открывает файл на чтение и связывает с ним заданный номер.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <opnget /3/'input.txt'> -->
    <opnget 'c:\refal\examples\test.txt'> -->

#### Функция opnput

ВЫЗОВ:

    <opnput Ez En Ef>

где En - номер файла (макроцифра от /0/ до /4/, причем /0/ можно
опускать), а Ef - объектное выражение, представляющее собой спецификацию
файла.

Ez - это пусто или объектный символ '*', означающий что будет дозапись
в уже существующий файл. Если файл не существует, то файл будет
создан, и в него будет осуществляться обычная запись с самого начала. 

ОПИСАНИЕ:

Эта функция открывает файл на запись (или дозапись) и связывает с
ним заданный номер.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <opnput /3/'output.txt'> -->
    <opnput 'c:\refal\examples\test.txt'> -->
    <opnput '*c:\refal\examples\test.txt'> -->

#### Функция print

ВЫЗОВ:

    <print Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

В результате выполнения функции print в стандартный выходной поток
(обычно это экран дисплея, но средствами операционной системы можно
переназначить его в некоторый файл), начиная с новой строки,
выводится выражение Ee. Если выражение не помещается в одной печатной строке,
оно продолжается на следующих строках. Печать пустого Ee вызывает пропуск
одной печатной строки. При использовании функции print выражение Ee
выводится следующим образом. Символы-литеры (объектные знаки) выводятся в
виде соответствующих литер. Структурные скобки "(" и ")" выводятся
в виде литер "(" и ")". Составные символы печатаются в том же виде, как они
изображаются в РЕФАЛ-программах, за исключением того, что в качестве
ограничителей используется не "/", а апостроф "'".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Ee

ПРИМЕР:

    <print 'function'(/f1/)> --> 'function'(/F1/)

и на экране (если вывод не переназначен в какой-либо другой файл при
запуске данной программы) появится:

    function('F1')

#### Функция printm

ВЫЗОВ:

    <printm Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

При использовании функции printm выражение выводится в том же виде,
в котором оно записывается в исходных РЕФАЛ-программах. Единственное
различие заключается в том, что при переходе на следующую строку
не ставится признак продолжения "+".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: Ee

ПРИМЕР:

    <printm 'function'(/f1/)> --> 'function'(/F1/)

и на экране (если вывод не переназначен в какой-либо другой файл
при запуске данной программы) появится:
 
    'function'(/F1/)

#### Функция prout

ВЫЗОВ:

    <prout Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

При использовании функции prout выражение Ee выводится точно так же
как и функцией print.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕР:

    <prout 'this'(/func/)> -->

и на экране (если вывод не переназначен в какой-либо другой файл
при запуске данной программы) появится:

    this('FUNC')

#### Функция proutm

ВЫЗОВ:

    <proutm Ee>

где Ee - произвольное объектное выражение.

ОПИСАНИЕ:

При использовании функции proutm выражение Ee выводится точно так
же как и функцией printm.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕР:

    <proutm 'this'(/func/)> -->

и на экране (если вывод не переназначен в какой-либо другой файл
при запуске данной программы) появится:

    'this'(/FUNC/)

#### Функция p1

ВЫЗОВ:

    <p1 Nn>

где Nn - макроцифра.

ОПИСАНИЕ:

Функция p1 производит прибавление единицы к макроцифре. Попытка прибавить
единицу к макроцифре /16777215/ приводит к авосту "Отождествление невозможно".

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: макроцифра, на единицу большая Nn.

ПРИМЕРЫ:

    <p1 /10/> --> /11/
    <p1 /738/> --> /739/
 
#### Функция renam

ВЫЗОВ:

    <renam Ee>

где Ee - выражение из символов-литер, представляет собой
два имени файлов (имена ограничены 40 символами) (возможно
с указанием пути), разделенных пробелом. 

ОПИСАНИЕ:

Функция renam копирует файл, заданный первым именем, в файл,
заданный вторым именем с уничтожением первого файла.
Таким образом реализуется либо переименование файла
(если оба имени отсылают к одной и той же директории),
либо перемещение файла из одной директории в другую
с сохранением того же имени или с присвоением файлу другого имени.
Если процесс переименования завершается с ошибкой,
происходит аварийное завершение программы.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <renam 'a.a b.b'> -->
    <renam 'a:\\a.a b:\\a.a'> -->
    <renam 'd:\\a\\a.a c:\\f1\\f1.1\\c.c'> -->

ЗАМЕЧАНИЕ: обратный слэш изображается путем двукратного
повторения. 
 
#### Функция sub

ВЫЗОВ:

    <sub (E1) E2>

где E1 и E2 - целые числа (может быть пустые).

ОПИСАНИЕ:

Функция sub предназначена для вычитания E2 из E1.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Результатом вызова функции sub является целое число. Если результат
положителен - знак '+' не ставитcя. Нулевой результат выдается
в виде макроцифры /0/.

ПРИМЕРЫ:

    <sub (/1/) /2/> --> '-' /1/
    <sub (/2/) > --> /2/
    <sub (/1//1/) /2/> --> /16777215/

#### Функция symb

ВЫЗОВ:

    <symb En>

где En - целое число в виде цепочки макроцифр (возможно, со знаком) (может быть пустое).

ОПИСАНИЕ:

Преобразует целое число, не превышающее по абсолютной величине 2147483647,
в символьное представление со знаком или без него.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ:

Ed - цепочка символов-литер, являющаяся
записью числа En в десятичной системе счисления.
Если число En положительно - знак '+' в Ed не ставитcя.
Нулевой результат изображается как '0'.

ПРИМЕРЫ:

    <symb /1000/> --> '1000'
    <symb '-'/1//0/> --> '-16777216'
    <symb > --> '0'
    <symb /0/> --> '0'
    <symb /59//10144256/> --> '1000000000'
    <symb '-'/0//25/> --> '-25'
 
#### Функция unlnk

ВЫЗОВ:

    <unlnk Ee>

где Ee - выражение из символов-литер, задаюшее имя файла (имя ограничено 40 символами) (возможно
с указанием пути).

ОПИСАНИЕ:

Указанный файл удаляется. Если процесс удаления завершается с ошибкой,
происходит аварийное завершение программы.

ВОЗВРАЩАЕМОЕ ЗНАЧЕНИЕ: пусто

ПРИМЕРЫ:

    <unlnk 'a.a'> -->
    <unlnk 'd:\\test\\a.a'> -->

ЗАМЕЧАНИЕ: обратный слэш изображается путем двукратного
повторения. 

### 2.15. Описание пустых функций



### 2.16. Описание спецификаторов


